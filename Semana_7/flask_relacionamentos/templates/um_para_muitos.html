{% extends 'base.html' %}

{% block title %}Relacionamento Um-para-Muitos{% endblock %}

{% block content %}
    <div class="page-header">
        <h1>Relacionamento Um-para-Muitos (1:M)</h1>
        <p><strong>Exemplo:</strong> `Autor` e `Livro`</p>
    </div>

    <div class="content-section">
        <h2>Explicação Conceitual</h2>
        <p>
            Este é o tipo de relacionamento mais comum. Um registro na Tabela A (o "um") pode estar associado a <strong>vários</strong> registros na Tabela B (os "muitos"). No entanto, cada registro na Tabela B só pode estar associado a <strong>um</strong> registro na Tabela A. A chave estrangeira fica na tabela do lado "muitos".
        </p>
    </div>

    <div class="content-section">
        <h2>Código do Modelo (`models.py`)</h2>
        <pre><code>
class Autor(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    nome = db.Column(db.String(100), nullable=False)
    
    # 'livros' será uma lista de objetos Livro. `uselist=True` é o padrão aqui.
    livros = db.relationship('Livro', back_populates='autor', cascade='all, delete-orphan')

class Livro(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    titulo = db.Column(db.String(150), nullable=False)
    
    # A ForeignKey fica no lado "muitos" (um livro tem um autor).
    autor_id = db.Column(db.Integer, db.ForeignKey('autor.id'), nullable=False)
    
    autor = db.relationship('Autor', back_populates='livros')
        </code></pre>
    </div>

    <div class="content-section">
        <h2>Demonstração ao Vivo</h2>
        <div class="demo-container">
            <div class="data-display" style="flex-basis: 100%;">
                <h3>Autores e Seus Livros</h3>
                {% if autores %}
                    <ul>
                    {% for autor in autores %}
                        <li>
                            <strong>Autor:</strong> {{ autor.nome }}
                            {% if autor.livros %}
                                <ul>
                                {% for livro in autor.livros %}
                                    <li><em>{{ livro.titulo }}</em></li>
                                {% endfor %}
                                </ul>
                            {% else %}
                                <p style="margin-left: 20px;"><em>Nenhum livro cadastrado.</em></p>
                            {% endif %}
                        </li>
                    {% endfor %}
                    </ul>
                {% else %}
                    <p>Nenhum autor cadastrado.</p>
                {% endif %}
            </div>
        </div>
        <div class="demo-container" style="margin-top: 2rem;">
            <div class="form-container">
                <h3>Adicionar Novo Autor</h3>
                <form action="{{ url_for('add_autor') }}" method="post">
                    <div class="form-group">
                        <label for="nome">Nome do Autor:</label>
                        <input type="text" id="nome" name="nome" required>
                    </div>
                    <button type="submit" class="btn">Adicionar Autor</button>
                </form>
            </div>
             <div class="form-container">
                <h3>Adicionar Novo Livro</h3>
                <form action="{{ url_for('um_para_muitos') }}" method="post">
                    <div class="form-group">
                        <label for="titulo">Título do Livro:</label>
                        <input type="text" id="titulo" name="titulo" required>
                    </div>
                    <div class="form-group">
                        <label for="autor_id">Autor:</label>
                        <select name="autor_id" id="autor_id" required>
                            {% for autor in autores %}
                                <option value="{{ autor.id }}">{{ autor.nome }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" class="btn">Adicionar Livro</button>
                </form>
            </div>
        </div>
    </div>
{% endblock %}
